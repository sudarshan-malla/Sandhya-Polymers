<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Sandhya Polymers</title>
    <style>
        :root { --primary: #1a4a7c; --bg: #f0f2f5; }
        body { font-family: 'Segoe UI', Arial, sans-serif; background: var(--bg); margin: 0; padding: 10px; }
        
        /* Input Panel */
        .ui-panel { max-width: 850px; margin: 0 auto 20px; background: #fff; padding: 15px; border-radius: 12px; box-shadow: 0 4px 12px rgba(0,0,0,0.1); }
        .section-box { border: 1px solid #e0e0e0; padding: 12px; margin-bottom: 15px; border-radius: 8px; background: #fafafa; }
        .entry-row { display: flex; gap: 5px; margin-bottom: 8px; }
        input, textarea { padding: 10px; border: 1px solid #ccc; border-radius: 6px; font-size: 14px; flex: 1; }
        .remark-input { width: 100%; margin-top: 5px; background: #fffbe6; }
        button { cursor: pointer; border: none; border-radius: 6px; font-weight: bold; }
        .add-btn { background: #28a745; color: white; padding: 8px; width: 100%; margin-bottom: 10px; }
        .del-btn { background: #ff4d4d; color: white; width: 40px; }
        .action-btn { background: var(--primary); color: white; width: 100%; padding: 15px; font-size: 1rem; margin-top: 10px; }

        /* A4 Print Layout */
        #printable { 
            width: 210mm; height: 297mm; padding: 15mm; margin: 20px auto;
            background: white; color: #000; box-shadow: 0 0 10px rgba(0,0,0,0.1);
            display: flex; flex-direction: column; overflow: hidden;
        }
        .letter-head { text-align: center; border-bottom: 2px solid #000; margin-bottom: 10px; padding-bottom: 5px; }
        .letter-head h1 { margin: 0; color: var(--primary); font-size: 26px; }
        .right-date { text-align: right; font-weight: bold; margin-bottom: 10px; }
        .address-block { margin-bottom: 15px; line-height: 1.3; font-size: 14px; }
        .subject-line { font-weight: bold; margin: 15px 0; text-indent: 40px; font-size: 14px; }
        
        table { width: 100%; border-collapse: collapse; margin: 10px 0; table-layout: fixed; }
        th, td { border: 1px solid #000; padding: 5px; text-align: left; font-size: 12px; word-wrap: break-word; }
        th { background: #f2f2f2; }
        .total-row { font-weight: bold; }
        .remark-text { font-style: italic; font-size: 11px; margin-bottom: 10px; color: #333; border-left: 2px solid #ccc; padding-left: 5px; }
        .footer { margin-top: auto; text-align: right; padding-top: 20px; }
        .sig { border-top: 1px solid #000; display: inline-block; min-width: 180px; text-align: center; padding-top: 5px; font-size: 13px; }

        @media print {
            @page { size: A4; margin: 0; }
            .ui-panel { display: none !important; }
            body { background: white; padding: 0; }
            #printable { margin: 0; border: none; box-shadow: none; width: 210mm; height: 297mm; }
        }
    </style>
</head>
<body>

<div class="ui-panel">
    <h2 style="text-align:center;">Data Entry Portal</h2>
    
    <div class="section-box">
        <label>Report Date:</label>
        <input type="date" id="reportDate" onchange="updatePreview()">
        <label style="display:block; margin-top:10px;">Reference Text:</label>
        <input type="text" id="refText" placeholder="Reference Number" onchange="updatePreview()">
    </div>

    <div id="entry-containers"></div>

    <button class="action-btn" onclick="updatePreview()">1. REFRESH A4 PREVIEW</button>
    <button class="action-btn" style="background:#495057" onclick="window.print()">2. DOWNLOAD PDF</button>
</div>

<div id="printable">
    <div class="letter-head">
        <h1>SANDHYA POLYMERS</h1>
        <p style="font-size:12px; margin:2px;">Plot No: 90, APIIC Industrial Park, AutoNagar, Rajahmundry | Ph: +91 8328621326</p>
    </div>

    <div class="right-date" id="outDate"></div>

    <div class="address-block">
        To,<br>
        The Manager,<br>
        Karnataka Bank,<br>
        Danavaipet,<br>
        Rajahmundry.
    </div>

    <div style="font-size:14px;">Respected Sir,</div>
    
    <div class="subject-line">
        Sub: Request for submitting monthly Purchases, Sales, Stocks with Reference below<br>
        Ref: <span id="outRef" style="text-decoration: underline;"></span>
    </div>

    <div id="tables-output"></div>

    <div class="footer">
        <div style="text-align: left; margin-bottom: 20px; font-size: 16px;">
        Thanking You,<br>
        Yours Sincerely,
    </div>
        <p style="margin-bottom:40px;">For <strong>Sandhya Polymers</strong></p>
        <div class="sig">Authorised Signatory</div>
    </div>
</div>

<script>
    let sections = {
        purchase: { label: 'PURCHASE', rows: [], remark: '' },
        sales: { label: 'SALES', rows: [], remark: '' },
        debtor: { label: 'DEBTORS', rows: [], remark: '' },
        creditor: { label: 'CREDITORS', rows: [], remark: '' }
    };

    function initUI() {
        const container = document.getElementById('entry-containers');
        container.innerHTML = Object.keys(sections).map(key => `
            <div class="section-box">
                <h3>${sections[key].label}</h3>
                <div id="${key}-list"></div>
                <button class="add-btn" onclick="addRow('${key}')">+ Add ${sections[key].label} Row</button>
                <input type="text" class="remark-input" placeholder="Remarks for ${sections[key].label}" onchange="updateRemark('${key}', this.value)">
            </div>
        `).join('');
    }

    function addRow(key) {
        let row = key.includes('or') ? { desc: '', amt: '' } : { desc: '', qty: '', rate: '' };
        sections[key].rows.push(row);
        renderRows(key);
    }

    function removeRow(key, i) {
        sections[key].rows.splice(i, 1);
        renderRows(key);
        updatePreview();
    }

    function updateVal(key, i, field, val) {
        sections[key].rows[i][field] = val;
    }

    function updateRemark(key, val) {
        sections[key].remark = val;
        updatePreview();
    }

    function renderRows(key) {
        const list = document.getElementById(key + '-list');
        list.innerHTML = sections[key].rows.map((row, i) => `
            <div class="entry-row">
                <input type="text" placeholder="Desc" value="${row.desc}" onchange="updateVal('${key}',${i},'desc',this.value)">
                ${key.includes('or') ? 
                    `<input type="number" placeholder="Amt" value="${row.amt}" onchange="updateVal('${key}',${i},'amt',this.value)">` :
                    `<input type="number" placeholder="Qty" value="${row.qty}" onchange="updateVal('${key}',${i},'qty',this.value)">
                     <input type="number" placeholder="Rate" value="${row.rate}" onchange="updateVal('${key}',${i},'rate',this.value)">`
                }
                <button class="del-btn" onclick="removeRow('${key}',${i})">X</button>
            </div>
        `).join('');
    }

    function updatePreview() {
        const dateVal = document.getElementById('reportDate').value;
        document.getElementById('outDate').innerText = "Date: " + (dateVal || "__________");
        document.getElementById('outRef').innerText = document.getElementById('refText').value || "____________________";

        let html = "";
        Object.keys(sections).forEach(key => {
            let data = sections[key];
            html += `<h4 style="margin: 5px 0 2px 0; font-size:13px;">${data.label} DETAILS:</h4>`;
            
            if (data.rows.length === 0) {
                html += `<p style="font-size:11px; margin-bottom:5px;">No ${data.label} as on ${dateVal}</p>`;
            } else {
                let total = 0;
                if (!key.includes('or')) {
                    html += `<table><tr><th width="40">SNo</th><th>Description</th><th width="60">Qty</th><th width="80">Rate</th><th width="100">Value</th></tr>`;
                    data.rows.forEach((r, i) => {
                        let v = (parseFloat(r.qty)||0) * (parseFloat(r.rate)||0);
                        total += v;
                        html += `<tr><td>${i+1}</td><td>${r.desc}</td><td>${r.qty}</td><td>${r.rate}</td><td>${v.toFixed(2)}</td></tr>`;
                    });
                    html += `<tr class="total-row"><td colspan="4">TOTAL</td><td>${total.toFixed(2)}</td></tr></table>`;
                } else {
                    html += `<table><tr><th width="40">SNo</th><th>Description</th><th width="120">Amount</th></tr>`;
                    data.rows.forEach((r, i) => {
                        let a = parseFloat(r.amt) || 0; total += a;
                        html += `<tr><td>${i+1}</td><td>${r.desc}</td><td>${a.toFixed(2)}</td></tr>`;
                    });
                    html += `<tr class="total-row"><td colspan="2">TOTAL</td><td>${total.toFixed(2)}</td></tr></table>`;
                }
            }
            if(data.remark) html += `<div class="remark-text">Remarks: ${data.remark}</div>`;
        });
        document.getElementById('tables-output').innerHTML = html;
    }

    window.onload = () => { 
        document.getElementById('reportDate').valueAsDate = new Date();
        initUI();
        Object.keys(sections).forEach(addRow);
        updatePreview();
    };
</script>

</body>
</html>
