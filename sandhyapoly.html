<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>Sandhya Polymers</title>
    <style>
        :root { --primary: #1a4a7c; --bg: #f0f2f5; --success: #28a745; --danger: #dc3545; }
        
        body { font-family: -apple-system, system-ui, sans-serif; background: var(--bg); margin: 0; padding: 0; }
        
        /* Navigation */
        .nav-bar { display: flex; background: var(--primary); position: sticky; top: 0; z-index: 1000; }
        .nav-bar button { flex: 1; padding: 15px; border: none; background: none; color: white; font-weight: bold; opacity: 0.7; }
        .nav-bar button.active { opacity: 1; border-bottom: 4px solid white; }

        /* UI Panel */
        .ui-panel { padding: 15px; max-width: 600px; margin: 0 auto; }
        .section-box { background: #fff; border-radius: 12px; padding: 15px; margin-bottom: 20px; border: 1px solid #ddd; }
        .entry-card { background: #f9f9f9; padding: 12px; border-radius: 8px; border: 1px solid #eee; margin-bottom: 12px; }
        .entry-grid { display: grid; grid-template-columns: 1fr 1fr; gap: 10px; }
        input, textarea { padding: 12px; border: 1px solid #ccc; border-radius: 8px; font-size: 16px; width: 100%; box-sizing: border-box; }
        
        .add-btn { background: var(--success); color: white; padding: 12px; width: 100%; border-radius: 8px; border: none; font-weight: bold; margin-bottom: 10px; }
        .del-btn { background: var(--danger); color: white; padding: 5px 10px; border-radius: 4px; border: none; float: right; }

        /* PRINT PREVIEW & PDF STYLING */
        #printable-container { display: none; background: #525659; padding: 20px 0; }
        
        /* This is the magic fix for "cut off" text */
        #printable { 
            width: 210mm; 
            height: 297mm; 
            padding: 15mm 20mm; 
            margin: 0 auto;
            background: white; 
            color: #000;
            display: flex; 
            flex-direction: column;
            box-sizing: border-box; /* Ensures padding doesn't add to width */
            overflow: hidden; /* Keeps everything inside the A4 box */
            position: relative;
        }

        .letter-head { text-align: center; border-bottom: 2px solid #000; margin-bottom: 10px; padding-bottom: 5px; }
        .letter-head h1 { margin: 0; color: var(--primary); font-size: 24px; }
        .right-date { text-align: right; font-weight: bold; margin: 5px 0; }
        .address-block { margin-bottom: 10px; line-height: 1.3; font-size: 13px; }
        .subject-line { font-weight: bold; margin: 10px 0; text-indent: 30px; font-size: 13px; line-height: 1.4; }
        
        table { width: 100%; border-collapse: collapse; margin: 8px 0; table-layout: fixed; page-break-inside: avoid; }
        th, td { border: 1px solid #000; padding: 5px; text-align: left; font-size: 11px; overflow: hidden; }
        th { background: #f2f2f2; }
        .total-row { font-weight: bold; }
        .remark-text { font-style: italic; font-size: 10px; margin-top: 2px; color: #333; }
        
        .footer { margin-top: auto; text-align: right; padding-bottom: 10px; }
        .sig { border-top: 1px solid #000; display: inline-block; min-width: 150px; text-align: center; padding-top: 5px; font-size: 12px; }

        @media print {
            @page { size: A4; margin: 0; }
            body { background: white; }
            .nav-bar, .ui-panel, .no-print { display: none !important; }
            #printable-container { display: block !important; padding: 0; background: white; }
            #printable { margin: 0; border: none; width: 210mm; height: 297mm; padding: 15mm 20mm; }
        }

        /* Mobile Scale Factor for Preview */
        @media screen and (max-width: 210mm) {
            #printable { transform: scale(0.4); transform-origin: top center; }
            #printable-container { height: 130mm; overflow: hidden; }
        }
    </style>
</head>
<body>

<div class="nav-bar">
    <button id="editTab" class="active" onclick="showTab('edit')">1. ENTER DATA</button>
    <button id="viewTab" onclick="showTab('view')">2. VIEW & PRINT</button>
</div>

<div id="edit-panel" class="ui-panel">
    <div class="section-box">
        <h3>Report Header</h3>
        <input type="date" id="reportDate" onchange="updatePreview()">
        <input type="text" id="refText" placeholder="Ref: Loan A/c or Subject Ref" style="margin-top:10px;" onchange="updatePreview()">
    </div>
    <div id="entry-containers"></div>
    <button class="add-btn" style="background:var(--primary); padding:18px;" onclick="showTab('view')">PREVIEW A4 PAGE</button>
</div>

<div id="printable-container">
    <div style="text-align: center;" class="no-print">
        <button onclick="window.print()" style="padding: 10px 25px; border-radius: 20px; font-weight: bold; margin-bottom: 10px;">SAVE AS PDF</button>
    </div>
    <div id="printable">
        <div class="letter-head">
            <h1>SANDHYA POLYMERS</h1>
            <p style="font-size:11px; margin:2px;">Plot No: 90, APIIC Industrial Park, Autonagar, Rajahmundry | Ph: +91 8328621326</p>
        </div>
        <div class="right-date" id="outDate"></div>
        <div class="address-block">To,<br>The Manager,<br>Karnataka Bank, Danavaipet, Rajahmundry.</div>
        <div style="font-size:13px;">Respected Sir,</div>
        <div class="subject-line">
            Sub: Request for submitting monthly Purchases, Sales, Stocks with Reference below<br>
            Ref: <span id="outRef" style="text-decoration: underline;"></span>
        </div>
        <div id="tables-output"></div>
        <div class="footer">
            <div style="text-align: left; margin-bottom: 20px; font-size: 16px;">
                Thanking You,<br>
                Yours Sincerely,
            </div>
            <p style="margin-bottom:30px; font-size:13px;">For <strong>Sandhya Polymers</strong></p>
            <div class="sig">Authorised Signatory</div>
        </div>
    </div>
</div>

<script>
    let sections = {
        purchase: { label: 'PURCHASE', rows: [], remark: '' },
        sales: { label: 'SALES', rows: [], remark: '' },
        debtor: { label: 'DEBTORS', rows: [], remark: '' },
        creditor: { label: 'CREDITORS', rows: [], remark: '' }
    };

    function showTab(tab) {
        document.getElementById('edit-panel').style.display = tab === 'edit' ? 'block' : 'none';
        document.getElementById('printable-container').style.display = tab === 'view' ? 'block' : 'none';
        document.getElementById('editTab').className = tab === 'edit' ? 'active' : '';
        document.getElementById('viewTab').className = tab === 'view' ? 'active' : '';
        if(tab === 'view') updatePreview();
    }

    function initUI() {
        const container = document.getElementById('entry-containers');
        container.innerHTML = Object.keys(sections).map(key => `
            <div class="section-box">
                <h3>${sections[key].label}</h3>
                <div id="${key}-list"></div>
                <button class="add-btn" onclick="addRow('${key}')">+ Add Item</button>
                <input type="text" style="background:#fffbe6;" placeholder="Remarks for ${sections[key].label}" onchange="updateRemark('${key}', this.value)">
            </div>
        `).join('');
    }

    function addRow(key) {
        let row = key.includes('or') ? { desc: '', amt: '' } : { desc: '', qty: '', rate: '' };
        sections[key].rows.push(row);
        renderRows(key);
    }

    function removeRow(key, i) {
        sections[key].rows.splice(i, 1);
        renderRows(key);
    }

    function updateVal(key, i, field, val) { sections[key].rows[i][field] = val; }
    function updateRemark(key, val) { sections[key].remark = val; }

    function renderRows(key) {
        const list = document.getElementById(key + '-list');
        list.innerHTML = sections[key].rows.map((row, i) => `
            <div class="entry-card">
                <button class="del-btn" onclick="removeRow('${key}',${i})">X</button>
                <div class="entry-grid">
                    <input type="text" style="grid-column: span 2;" placeholder="Description" value="${row.desc}" onchange="updateVal('${key}',${i},'desc',this.value)">
                    ${key.includes('or') ? 
                        `<input type="number" style="grid-column: span 2;" placeholder="Amount" value="${row.amt}" onchange="updateVal('${key}',${i},'amt',this.value)">` :
                        `<input type="number" placeholder="Qty" value="${row.qty}" onchange="updateVal('${key}',${i},'qty',this.value)">
                         <input type="number" placeholder="Rate" value="${row.rate}" onchange="updateVal('${key}',${i},'rate',this.value)">`
                    }
                </div>
            </div>
        `).join('');
    }

    function updatePreview() {
        document.getElementById('outDate').innerText = "Date: " + document.getElementById('reportDate').value;
        document.getElementById('outRef').innerText = document.getElementById('refText').value || "________________";
        let html = "";
        Object.keys(sections).forEach(key => {
            let data = sections[key];
            html += `<h4 style="margin: 5px 0 2px 0; font-size:12px; text-decoration:underline;">${data.label} DETAILS:</h4>`;
            if (data.rows.length === 0) {
                html += `<p style="font-size:10px; margin:0;">No ${data.label} as on date.</p>`;
            } else {
                let total = 0;
                if (!key.includes('or')) {
                    html += `<table><tr><th width="30">#</th><th>Description</th><th width="40">Qty</th><th width="60">Rate</th><th width="80">Value</th></tr>`;
                    data.rows.forEach((r, i) => {
                        let v = (parseFloat(r.qty)||0) * (parseFloat(r.rate)||0); total += v;
                        html += `<tr><td>${i+1}</td><td>${r.desc}</td><td>${r.qty}</td><td>${r.rate}</td><td>${v.toFixed(2)}</td></tr>`;
                    });
                    html += `<tr class="total-row"><td colspan="4">TOTAL</td><td>${total.toFixed(2)}</td></tr></table>`;
                } else {
                    html += `<table><tr><th width="30">#</th><th>Description</th><th width="100">Amount</th></tr>`;
                    data.rows.forEach((r, i) => {
                        let a = parseFloat(r.amt) || 0; total += a;
                        html += `<tr><td>${i+1}</td><td>${r.desc}</td><td>${a.toFixed(2)}</td></tr>`;
                    });
                    html += `<tr class="total-row"><td colspan="2">TOTAL</td><td>${total.toFixed(2)}</td></tr></table>`;
                }
            }
            if(data.remark) html += `<div class="remark-text">Remarks: ${data.remark}</div>`;
        });
        document.getElementById('tables-output').innerHTML = html;
    }

    window.onload = () => { document.getElementById('reportDate').valueAsDate = new Date(); initUI(); Object.keys(sections).forEach(addRow); };
</script>
</body>
</html>

