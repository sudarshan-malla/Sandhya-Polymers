<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>Sandhya Polymers - Mobile Bank Report</title>
    <style>
        :root { --primary: #1a4a7c; --bg: #f0f2f5; --success: #28a745; --danger: #dc3545; }
        
        /* General Reset */
        body { font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, sans-serif; background: var(--bg); margin: 0; padding: 0; }
        
        /* Navigation / Tabs for Mobile */
        .nav-bar { display: flex; background: var(--primary); position: sticky; top: 0; z-index: 1000; box-shadow: 0 2px 5px rgba(0,0,0,0.2); }
        .nav-bar button { flex: 1; padding: 15px; border: none; background: none; color: white; font-weight: bold; font-size: 14px; opacity: 0.7; }
        .nav-bar button.active { opacity: 1; border-bottom: 4px solid white; }

        /* Input Panel - Optimized for Vertical Scrolling */
        .ui-panel { padding: 15px; max-width: 600px; margin: 0 auto; display: block; }
        .section-box { background: #fff; border-radius: 12px; padding: 15px; margin-bottom: 20px; box-shadow: 0 2px 8px rgba(0,0,0,0.05); border: 1px solid #ddd; }
        h3 { color: var(--primary); margin: 0 0 15px 0; font-size: 18px; border-bottom: 1px solid #eee; padding-bottom: 5px; }

        /* Stacked Input Rows for Mobile */
        .entry-card { background: #f9f9f9; padding: 12px; border-radius: 8px; border: 1px solid #eee; margin-bottom: 12px; position: relative; }
        .entry-grid { display: grid; grid-template-columns: 1fr 1fr; gap: 10px; }
        .full-width { grid-column: span 2; }
        
        input, textarea { padding: 12px; border: 1px solid #ccc; border-radius: 8px; font-size: 16px; width: 100%; box-sizing: border-box; outline: none; }
        input:focus { border-color: var(--primary); box-shadow: 0 0 0 2px rgba(26,74,124,0.1); }
        
        .add-btn { background: var(--success); color: white; padding: 12px; width: 100%; border-radius: 8px; font-weight: bold; border: none; margin-top: 5px; cursor: pointer; }
        .del-btn { background: var(--danger); color: white; padding: 5px 10px; border-radius: 4px; border: none; font-size: 12px; float: right; margin-bottom: 5px; }

        /* A4 Print Layout - Responsive Preview */
        #printable-container { display: none; padding: 10px; overflow-x: auto; background: #525659; min-height: 100vh; }
        #printable { 
            width: 210mm; min-height: 297mm; padding: 15mm; margin: 0 auto;
            background: white; color: #000; box-shadow: 0 0 20px rgba(0,0,0,0.5);
            display: flex; flex-direction: column; box-sizing: border-box;
        }

        /* Document Typography */
        .letter-head { text-align: center; border-bottom: 2px solid #000; margin-bottom: 10px; padding-bottom: 5px; }
        .letter-head h1 { margin: 0; color: var(--primary); font-size: 24px; }
        .right-date { text-align: right; font-weight: bold; margin: 10px 0; }
        .address-block { margin-bottom: 15px; line-height: 1.4; font-size: 14px; }
        .subject-line { font-weight: bold; margin: 15px 0; text-indent: 40px; font-size: 14px; }
        
        table { width: 100%; border-collapse: collapse; margin: 10px 0; table-layout: fixed; }
        th, td { border: 1px solid #000; padding: 6px; text-align: left; font-size: 11px; word-wrap: break-word; }
        th { background: #f2f2f2; }
        .total-row { font-weight: bold; }
        .remark-text { font-style: italic; font-size: 11px; margin-top: 5px; color: #444; border-left: 3px solid #ddd; padding-left: 8px; }
        
        .footer { margin-top: auto; text-align: right; padding-top: 30px; }
        .sig { border-top: 1px solid #000; display: inline-block; min-width: 180px; text-align: center; padding-top: 5px; font-size: 13px; }

        @media print {
            .nav-bar, .ui-panel, .add-btn, .del-btn { display: none !important; }
            #printable-container { display: block !important; padding: 0; background: white; }
            #printable { margin: 0; border: none; box-shadow: none; width: 210mm; height: 297mm; }
            body { background: white; }
        }

        /* Scale preview for mobile screens */
        @media screen and (max-width: 210mm) {
            #printable { transform: scale(0.45); transform-origin: top center; margin-top: -150px; }
            #printable-container { overflow: hidden; height: 135mm; }
        }
    </style>
</head>
<body>

<div class="nav-bar">
    <button id="editTab" class="active" onclick="showTab('edit')">EDIT DATA</button>
    <button id="viewTab" onclick="showTab('view')">PREVIEW & PDF</button>
</div>

<div id="edit-panel" class="ui-panel">
    <div class="section-box">
        <h3>General Information</h3>
        <label style="font-size: 12px; font-weight: bold; color: #666;">REPORT DATE</label>
        <input type="date" id="reportDate" onchange="updatePreview()" style="margin-bottom:15px;">
        
        <label style="font-size: 12px; font-weight: bold; color: #666;">REFERENCE NUMBER / TEXT</label>
        <input type="text" id="refText" placeholder="e.g. Loan A/c 5566" onchange="updatePreview()">
    </div>

    <div id="entry-containers"></div>

    <div style="padding: 20px 0;">
        <button class="add-btn" style="background: var(--primary); padding: 18px;" onclick="showTab('view')">PREVIEW FINAL REPORT</button>
    </div>
</div>

<div id="printable-container">
    <div style="text-align: center; margin-bottom: 10px;">
        <button onclick="window.print()" style="background: white; color: black; padding: 10px 20px; border-radius: 20px; font-weight: bold; border: none;">Click to Download PDF</button>
    </div>
    <div id="printable">
        <div class="letter-head">
            <h1>SANDHYA POLYMERS</h1>
            <p style="font-size:11px; margin:2px;">Plot No: 45, Industrial Park, Rajahmundry | Ph: +91 99999 88888</p>
        </div>

        <div class="right-date" id="outDate"></div>

        <div class="address-block">
            To,<br>
            The Manager,<br>
            Karnataka Bank,<br>
            Danavaipet,<br>
            Rajahmundry.
        </div>

        <div style="font-size:14px;">Respected Sir,</div>
        
        <div class="subject-line">
            Sub: Request for submitting monthly Purchases, Sales, Stocks with Reference below<br>
            Ref: <span id="outRef" style="text-decoration: underline;"></span>
        </div>

        <div id="tables-output"></div>

        <div class="footer">
            <p style="margin-bottom:40px;">For <strong>Sandhya Polymers</strong></p>
            <div class="sig">Authorised Signatory</div>
        </div>
    </div>
</div>

<script>
    let sections = {
        purchase: { label: 'PURCHASE', rows: [], remark: '' },
        sales: { label: 'SALES', rows: [], remark: '' },
        debtor: { label: 'DEBTORS', rows: [], remark: '' },
        creditor: { label: 'CREDITORS', rows: [], remark: '' }
    };

    function showTab(tab) {
        document.getElementById('edit-panel').style.display = tab === 'edit' ? 'block' : 'none';
        document.getElementById('printable-container').style.display = tab === 'view' ? 'block' : 'none';
        document.getElementById('editTab').className = tab === 'edit' ? 'active' : '';
        document.getElementById('viewTab').className = tab === 'view' ? 'active' : '';
        if(tab === 'view') updatePreview();
    }

    function initUI() {
        const container = document.getElementById('entry-containers');
        container.innerHTML = Object.keys(sections).map(key => `
            <div class="section-box">
                <h3>${sections[key].label}</h3>
                <div id="${key}-list"></div>
                <button class="add-btn" onclick="addRow('${key}')">+ Add ${sections[key].label} Item</button>
                <textarea class="remark-input" style="margin-top:10px; background:#fffbe6;" placeholder="Add remarks for ${sections[key].label}..." onchange="updateRemark('${key}', this.value)"></textarea>
            </div>
        `).join('');
    }

    function addRow(key) {
        let row = key.includes('or') ? { desc: '', amt: '' } : { desc: '', qty: '', rate: '' };
        sections[key].rows.push(row);
        renderRows(key);
    }

    function removeRow(key, i) {
        sections[key].rows.splice(i, 1);
        renderRows(key);
    }

    function updateVal(key, i, field, val) {
        sections[key].rows[i][field] = val;
    }

    function updateRemark(key, val) {
        sections[key].remark = val;
    }

    function renderRows(key) {
        const list = document.getElementById(key + '-list');
        list.innerHTML = sections[key].rows.map((row, i) => `
            <div class="entry-card">
                <button class="del-btn" onclick="removeRow('${key}',${i})">Remove</button>
                <div class="entry-grid">
                    <div class="full-width">
                        <input type="text" placeholder="Item Description" value="${row.desc}" onchange="updateVal('${key}',${i},'desc',this.value)">
                    </div>
                    ${key.includes('or') ? 
                        `<div class="full-width"><input type="number" placeholder="Amount" value="${row.amt}" onchange="updateVal('${key}',${i},'amt',this.value)"></div>` :
                        `<div><input type="number" placeholder="Qty" value="${row.qty}" onchange="updateVal('${key}',${i},'qty',this.value)"></div>
                         <div><input type="number" placeholder="Rate" value="${row.rate}" onchange="updateVal('${key}',${i},'rate',this.value)"></div>`
                    }
                </div>
            </div>
        `).join('');
    }

    function updatePreview() {
        const dateVal = document.getElementById('reportDate').value;
        document.getElementById('outDate').innerText = "Date: " + (dateVal || "__________");
        document.getElementById('outRef').innerText = document.getElementById('refText').value || "____________________";

        let html = "";
        Object.keys(sections).forEach(key => {
            let data = sections[key];
            html += `<h4 style="margin: 8px 0 2px 0; font-size:12px; border-left: 4px solid var(--primary); padding-left: 5px;">${data.label} DETAILS:</h4>`;
            
            if (data.rows.length === 0) {
                html += `<p style="font-size:10px; margin-bottom:5px; color:#666;">No ${data.label} records for this period.</p>`;
            } else {
                let total = 0;
                if (!key.includes('or')) {
                    html += `<table><tr><th width="30">#</th><th>Description</th><th width="40">Qty</th><th width="60">Rate</th><th width="80">Value</th></tr>`;
                    data.rows.forEach((r, i) => {
                        let v = (parseFloat(r.qty)||0) * (parseFloat(r.rate)||0);
                        total += v;
                        html += `<tr><td>${i+1}</td><td>${r.desc}</td><td>${r.qty}</td><td>${r.rate}</td><td>${v.toFixed(2)}</td></tr>`;
                    });
                    html += `<tr class="total-row"><td colspan="4">TOTAL</td><td>${total.toFixed(2)}</td></tr></table>`;
                } else {
                    html += `<table><tr><th width="30">#</th><th>Description</th><th width="100">Amount</th></tr>`;
                    data.rows.forEach((r, i) => {
                        let a = parseFloat(r.amt) || 0; total += a;
                        html += `<tr><td>${i+1}</td><td>${r.desc}</td><td>${a.toFixed(2)}</td></tr>`;
                    });
                    html += `<tr class="total-row"><td colspan="2">TOTAL</td><td>${total.toFixed(2)}</td></tr></table>`;
                }
            }
            if(data.remark) html += `<div class="remark-text">Remarks: ${data.remark}</div>`;
        });
        document.getElementById('tables-output').innerHTML = html;
    }

    window.onload = () => { 
        document.getElementById('reportDate').valueAsDate = new Date();
        initUI();
        Object.keys(sections).forEach(addRow);
        updatePreview();
    };
</script>

</body>
</html>
